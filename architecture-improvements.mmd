graph TD
    %% CURRENT ARCHITECTURE
    subgraph "Current Architecture" 
        subgraph API_Gateway
            Kong["Kong API Gateway<br/>(Port 8000/8001)"]
        end

        subgraph Core_Services
            Medecins["Medecins Service<br/>(Port 8081)"]
            Ordonnances["Ordonnances Service<br/>(Port 8082)"]
            Patients["Patients Service<br/>(Port 8083)"]
            Radiologues["Radiologues Service<br/>(Port 8084)"]
            Reports["Reports Service<br/>(Port 8085)"]
        end

        subgraph Service_Discovery
            Consul["Consul<br/>(Port 8500)"]
        end

        subgraph Message_Broker
            RabbitMQ["RabbitMQ<br/>(Port 5672/15672)"]
        end

        subgraph Data_Storage
            MongoDB["MongoDB<br/>(Port 27017)"]
            Redis["Redis Cache<br/>(Port 6379)"]
        end

        subgraph Observability
            Prometheus["Prometheus<br/>(Port 9090)"]
            Grafana["Grafana<br/>(Port 3000)"]
            OTel["OpenTelemetry<br/>Collector<br/>(Port 4317)"]
            Loki["Loki<br/>(Port 3100)"]
            Tempo["Tempo<br/>(Port 3200)"]
        end

        Kong --> Medecins & Ordonnances & Patients & Radiologues & Reports
        Kong --> Consul
        
        Medecins & Ordonnances & Patients & Radiologues & Reports --> MongoDB
        Medecins & Ordonnances & Patients & Radiologues & Reports --> Redis
        Medecins & Ordonnances & Patients & Radiologues & Reports -.-> RabbitMQ
        Medecins & Ordonnances & Patients & Radiologues & Reports --logs--> OTel
        
        Core_Services --> Consul
        
        OTel --> Tempo
        OTel --> Prometheus
        OTel --> Loki
        Prometheus --> Grafana
        Loki --> Grafana
        Tempo --> Grafana

        classDef issueNode fill:#ff9999,stroke:#ff0000
        classDef currentNode fill:#f9f9f9,stroke:#333
        
        class Kong,Medecins,Ordonnances,Patients,Radiologues,Reports,Consul,RabbitMQ,MongoDB,Redis,Prometheus,Grafana,OTel,Loki,Tempo currentNode
    end

    %% AREAS FOR IMPROVEMENT SECTION
    subgraph "Areas for Improvement"
        %% Security Issues
        Auth["üîí 1. Authentication<br/>Issues"]
        Config["‚öôÔ∏è 2. Configuration<br/>Management"]
        DbConn["üîå 3. Hardcoded<br/>DB Connections"]
        CodeDup["üîÑ 4. Code<br/>Duplication"]
        ApiDesign["üìù 5. Inconsistent<br/>API Design"]
        CircuitBreaker["‚ö° 6. Circuit<br/>Breakers"]
        DbMigration["üíæ 7. DB Migration<br/>Strategy"]
        Testing["üß™ 8. Testing<br/>Strategy"]
        IaC["üèóÔ∏è 9. Infrastructure<br/>as Code"]
        
        class Auth,Config,DbConn,CodeDup,ApiDesign,CircuitBreaker,DbMigration,Testing,IaC issueNode
    end

    %% ENHANCED ARCHITECTURE
    subgraph "Enhanced Architecture"
        subgraph Enhanced_API_Gateway
            Kong2["Kong API Gateway"]
            RateLimiting["Rate Limiting"]
            Authentication["Centralized Auth"]
        end

        subgraph Enhanced_Core_Services
            SharedLib["Shared Libraries"]
            subgraph Services
                Medecins2["Medecins"]
                Ordonnances2["Ordonnances"] 
                Patients2["Patients"]
                Radiologues2["Radiologues"]
                Reports2["Reports"]
            end
        end

        subgraph Enhanced_Infrastructure
            Consul2["Consul"]
            RabbitMQ2["RabbitMQ"]
            ConfigServer["Config Server"]
            K8s["Kubernetes"]
        end

        subgraph Enhanced_Data
            MongoDB2["MongoDB"]
            Redis2["Redis"]
            DBMigrations["DB Migrations"]
        end

        subgraph Enhanced_Observability
            ObservabilityStack["Unified Observability<br/>(Prometheus, Grafana, Loki, Tempo)"]
            CircuitBreakers["Circuit Breakers"]
        end

        subgraph Enhanced_DevOps
            CI_CD["CI/CD Pipeline"]
            Tests["Automated Tests"]
            Security["Security Scans"]
        end

        Kong2 --> Authentication
        Kong2 --> RateLimiting
        Kong2 --> Services
        
        Enhanced_Core_Services --> ConfigServer
        Services --> SharedLib
        Services --> CircuitBreakers
        Services --uses--> DBMigrations
        
        K8s --> Enhanced_Core_Services
        K8s --> Enhanced_API_Gateway
        K8s --> Enhanced_Data
        K8s --> Enhanced_Observability
        
        CI_CD --> Tests
        CI_CD --> Security
        
        classDef enhancedNode fill:#99ff99,stroke:#009900
        
        class Kong2,RateLimiting,Authentication,SharedLib,Medecins2,Ordonnances2,Patients2,Radiologues2,Reports2,Consul2,RabbitMQ2,ConfigServer,K8s,MongoDB2,Redis2,DBMigrations,ObservabilityStack,CircuitBreakers,CI_CD,Tests,Security enhancedNode
    end

    %% LINKAGE between issues and improvements
    Auth -.-> Authentication
    Config -.-> ConfigServer
    DbConn -.-> ConfigServer
    CodeDup -.-> SharedLib
    ApiDesign -.-> SharedLib
    CircuitBreaker -.-> CircuitBreakers
    DbMigration -.-> DBMigrations
    Testing -.-> Tests
    IaC -.-> K8s