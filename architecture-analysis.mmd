graph TD
    %% CURRENT ARCHITECTURE ISSUES

    subgraph "Current Architecture Issues" 
        subgraph "Configuration Issues"
            HardcodedDBConn["❌ Hardcoded DB Connections<br/>client = MongoClient('mongodb://admin:admin@localhost:27017/')"]
            WeakSecrets["❌ Weak Default Secrets<br/>JWT_SECRET = os.getenv('JWT_SECRET', 'replace-with-strong-secret')"]
            DuplicatedConfig["❌ Duplicated Config Classes<br/>across all services"]
        end

        subgraph "Authentication Issues"
            AuthPerService["❌ Authentication Logic<br/>Duplicated in Each Service"]
            MissingCentralAuth["❌ No Centralized<br/>Authentication Service"]
            WeakTokenVerification["❌ Inconsistent<br/>Token Verification"]
        end

        subgraph "Code Quality Issues"
            DuplicatedHealth["❌ Duplicated Health Check<br/>Implementation"]
            DuplicatedSchemas["❌ Duplicated MongoDB<br/>Validation Schemas"]
            InconsistentErrorHandling["❌ Inconsistent<br/>Error Handling"]
        end

        subgraph "API Design Issues"
            InconsistentRouting["❌ Inconsistent API Paths<br/>/api/v1/radiologues vs /api/medecins"]
            MixedStyles["❌ Mixed REST Style<br/>Implementation"]
            NoAPIVersioning["❌ No Consistent<br/>API Versioning"]
        end

        subgraph "Infrastructure Issues"
            NoMigrations["❌ No Database<br/>Migration Strategy"]
            NoK8s["❌ No Kubernetes<br/>Manifests"]
            CircuitBreakerInconsistency["❌ Inconsistent Circuit<br/>Breaker Implementation"]
        end
    end

    %% RECOMMENDED IMPROVEMENTS

    subgraph "Recommended Improvements"
        subgraph "Configuration Improvements"
            SharedLibrary["✅ Create Shared Library Package<br/>for Common Code"]
            ConfigService["✅ Add Centralized<br/>Configuration Service"]
            StrictEnvChecks["✅ Add Strict Environment<br/>Validation"]
        end

        subgraph "Authentication Improvements"
            AuthService["✅ Create Dedicated<br/>Authentication Service"]
            OAuth2["✅ Implement OAuth2<br/>Authorization"]
            TokenValidation["✅ Standardize Token<br/>Validation with JWTs"]
        end

        subgraph "Code Quality Improvements"
            CommonSDK["✅ Create Python SDK<br/>for Common Utilities"]
            AutoTests["✅ Add Automated Tests<br/>with Pytest"]
            ConsistentErrorRes["✅ Standardize Error<br/>Response Format"]
        end

        subgraph "API Design Improvements"
            OpenAPI["✅ Implement OpenAPI<br/>Specification"]
            APIGuidelines["✅ Create API Design<br/>Guidelines"]
            VersioningStrategy["✅ Adopt Consistent<br/>Versioning Strategy"]
        end

        subgraph "Infrastructure Improvements"
            MigrationTool["✅ Implement DB Migrations<br/>with Alembic"]
            K8sManifests["✅ Create Kubernetes<br/>Deployment Files"]
            Resilience["✅ Implement Consistent<br/>Resilience Patterns"]
        end
    end

    %% IMPLEMENTATION STRATEGY

    subgraph "Implementation Strategy"
        Phase1["1️⃣ Immediate: Fix Security Issues<br/>- Remove hardcoded credentials<br/>- Strengthen default secrets"]
        Phase2["2️⃣ Short-term: Extract Common Code<br/>- Create shared library<br/>- Standardize health checks"]
        Phase3["3️⃣ Mid-term: API & Auth Improvements<br/>- Build Auth service<br/>- Standardize API design"]
        Phase4["4️⃣ Long-term: Infrastructure<br/>- Database migrations<br/>- Kubernetes deployment"]
        
        Phase1 --> Phase2 --> Phase3 --> Phase4
    end

    classDef issueNode fill:#ffcccc,stroke:#ff0000
    classDef improvementNode fill:#ccffcc,stroke:#00aa00
    classDef phaseNode fill:#ffffcc,stroke:#aaaa00
    
    class HardcodedDBConn,WeakSecrets,DuplicatedConfig,AuthPerService,MissingCentralAuth,WeakTokenVerification,DuplicatedHealth,DuplicatedSchemas,InconsistentErrorHandling,InconsistentRouting,MixedStyles,NoAPIVersioning,NoMigrations,NoK8s,CircuitBreakerInconsistency issueNode
    class SharedLibrary,ConfigService,StrictEnvChecks,AuthService,OAuth2,TokenValidation,CommonSDK,AutoTests,ConsistentErrorRes,OpenAPI,APIGuidelines,VersioningStrategy,MigrationTool,K8sManifests,Resilience improvementNode
    class Phase1,Phase2,Phase3,Phase4 phaseNode
